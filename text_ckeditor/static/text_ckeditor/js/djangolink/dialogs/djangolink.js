var DjangoLinkDialog=function(b){function q(){var f=b(this),h=f.contents();b("html, body",h).scrollTop(0);b("h1, .submit-row",h).hide().end();b("#content, #container",h).css({minWidth:0,padding:0});b("form",h).on("submit",g);f.show()}function g(b){b.preventDefault()}CKEDITOR.dialog.add("djangolink",function(f){var h=CKEDITOR.plugins.djangolink,g=f.config.djangolinkIframeURL,r=f.config.djangolinkVerifyURL;return{onOk:function(){for(var a={},p=this,l=b(p.parts.contents.$).find("iframe").contents(),
m=l.find("form"),g=m.find("input, select"),n=0;n<g.length;n++)a[g[n].name]=g[n].value;b.ajax({method:"post",url:r,data:a,success:function(d,e,c){if("true"!=d.valid){b(".form-rows",m).removeClass("errors");b(".errorlist",m).remove();for(e=0;e<d.errors.length;e++){c=d.errors[e].shift();c=b(".form-row.field-"+c,m);for(var g='<ul class="errorlist">',k=0;k<d.errors[e].length;k++)g+="<li>"+d.errors[e][k]+"</li>";g+="</ul>";c.addClass("errors");c.prepend(g)}return!1}e=f.getSelection();c=p.getSelectedElement();
d=h.getLinkAttributes(f,d.data,d.link_value);if(c){if(g=c.data("cke-saved-href"),k=c.getHtml(),c.setAttributes(d.set),c.removeAttributes(d.removed),g==k||"email"==a.type&&-1!=k.indexOf("@"))c.setHtml("email"==a.type?a.email.address:d.set["data-cke-saved-href"]),e.selectElement(c)}else e=e.getRanges()[0],e.collapsed&&(c=new CKEDITOR.dom.text("link",f.document),e.insertNode(c),e.selectNodeContents(c)),d=new CKEDITOR.style({element:"a",attributes:d.set}),d.type=CKEDITOR.STYLE_INLINE,d.applyToRange(e,
f),e.select();b("body",l).remove();CKEDITOR.dialog.getCurrent().hide()}});return!1},onShow:function(){var a=this.getParentEditor(),f=a.getSelection();(a=h.getSelectedLink(a))&&a.hasAttribute("href")?f.getSelectedElement()||f.selectElement(a):a=null;this._.selectedElement=a;var f=h.parseLinkAttributes(a),a=b(this.parts.contents.$),l=b("iframe",a);a.css({padding:"0"});b(".cke_dialog_page_contents, table[role=presentation]",a).css({height:"100%"});b(".cke_dialog_ui_vbox_child",a).css({padding:0,height:"100%"});
b(".cke_dialog_ui_vbox_child iframe",a).css({display:"block"});l.hide().unbind("load").attr({src:g+"?_popup=true&"+b.param(f)}).on("load",q)},title:"Link",width:800,height:200,minHeight:100,maxHeight:'80vh',contents:[{elements:[{type:"html",html:'<iframe style="position:static; width:100%; height:100%; border:none;" />'}]}]}})}(django.jQuery);